# HOME ANYWHERE BLUE - COMPLETE KEY EXTRACTION

**Generated**: 2025-12-27
**Application**: Home Anywhere Blue (March 2025)
**Location**: C:\Program Files\Home Anywhere Blue

---

## 1. ENCRYPTION PRIVATE KEYS (XOR Cipher)

### Private Key 1 (_privateKey) - 256 bytes

**Location**: `Home_Anywhere_D.Anb.Ha.Commun.IPcom.TCPSecureCommunication`
**Usage**: Primary encryption key (when PublicKey is available)

**Hexadecimal**:
```
53 83 FB 32 7F 7E 9A E9 01 B3 7F 80 06 CF 39 26
6F 5D 25 5B 1E 26 28 C4 B3 78 04 AC 9F 0B AE 9D
57 AC 4E 82 0E B4 BA 6C 27 38 0A 71 9B E1 F7 FD
14 CC 14 0D 71 E5 B8 F7 7C CB E0 0B 04 78 B1 7F
2B EA 85 41 95 22 18 EE 06 FF 79 13 26 D3 08 10
75 04 53 6C 04 FD 91 F3 31 93 B6 14 E3 53 F6 CE
6E C3 74 FE CE 62 01 BD 8D 11 26 39 0A 74 51 CA
56 42 51 D5 7B 8E A6 47 DC 7F 74 09 90 8F 9A F2
0C 74 81 64 10 0D 64 CE 54 B5 78 81 A5 90 36 EB
82 C9 E7 5C BD 3F 3B 29 D3 2F 22 6E 6F 24 DD FB
DD 98 00 1D 4B 82 CE 12 D1 33 29 22 4F 92 F9 94
EB 12 57 2F FA 30 C7 F1 9D 72 CA 8D 25 EB 2C 3D
E3 FB CC BC 54 11 53 25 E2 CE 78 F9 DC 6F E8 E2
FB 41 3C ED 6F 9A B1 F3 72 78 02 CC 91 3D 20 7F
BE E9 53 D4 FB FF 6E 42 B1 F6 5E 4D 14 03 B4 FB
2F 53 7A BC 9E A7 CE 8E CA 08 C4 7B 19 A1 2B 7F
```

**C# Array**:
```csharp
byte[] _privateKey = new byte[256] {
    83, 131, 251, 50, 127, 126, 154, 233, 1, 179,
    127, 128, 6, 207, 57, 38, 111, 93, 37, 91,
    30, 38, 40, 196, 179, 120, 4, 172, 159, 11,
    174, 157, 87, 172, 78, 130, 14, 180, 186, 108,
    39, 56, 10, 113, 155, 225, 247, 253, 20, 204,
    20, 13, 113, 229, 184, 247, 124, 203, 224, 11,
    4, 120, 177, 127, 43, 234, 133, 65, 149, 34,
    24, 238, 6, 255, 121, 19, 38, 211, 8, 16,
    117, 4, 83, 108, 4, 253, 145, 243, 49, 147,
    182, 20, 227, 83, 246, 206, 110, 195, 116, 254,
    206, 98, 1, 189, 141, 17, 38, 57, 10, 116,
    81, 202, 86, 66, 81, 213, 123, 142, 166, 71,
    220, 127, 116, 9, 144, 143, 154, 242, 12, 116,
    129, 100, 16, 13, 100, 206, 84, 181, 120, 129,
    165, 144, 54, 235, 130, 201, 231, 92, 189, 63,
    59, 41, 211, 47, 34, 110, 111, 36, 221, 251,
    221, 152, 0, 29, 75, 130, 206, 18, 209, 51,
    41, 34, 79, 146, 249, 148, 235, 18, 87, 47,
    250, 48, 199, 241, 157, 114, 202, 141, 37, 235,
    44, 61, 227, 251, 204, 188, 84, 17, 83, 37,
    226, 206, 120, 249, 220, 111, 232, 226, 251, 65,
    60, 237, 111, 154, 177, 243, 114, 120, 2, 204,
    145, 61, 32, 127, 190, 233, 83, 212, 251, 255,
    110, 66, 177, 246, 94, 77, 20, 3, 180, 251,
    47, 83, 122, 188, 158, 167, 206, 142, 202, 8,
    196, 123, 25, 161, 43, 127
};
```

**Python/JavaScript**:
```python
privateKey1 = [
    0x53, 0x83, 0xFB, 0x32, 0x7F, 0x7E, 0x9A, 0xE9, 0x01, 0xB3,
    0x7F, 0x80, 0x06, 0xCF, 0x39, 0x26, 0x6F, 0x5D, 0x25, 0x5B,
    0x1E, 0x26, 0x28, 0xC4, 0xB3, 0x78, 0x04, 0xAC, 0x9F, 0x0B,
    0xAE, 0x9D, 0x57, 0xAC, 0x4E, 0x82, 0x0E, 0xB4, 0xBA, 0x6C,
    0x27, 0x38, 0x0A, 0x71, 0x9B, 0xE1, 0xF7, 0xFD, 0x14, 0xCC,
    0x14, 0x0D, 0x71, 0xE5, 0xB8, 0xF7, 0x7C, 0xCB, 0xE0, 0x0B,
    0x04, 0x78, 0xB1, 0x7F, 0x2B, 0xEA, 0x85, 0x41, 0x95, 0x22,
    0x18, 0xEE, 0x06, 0xFF, 0x79, 0x13, 0x26, 0xD3, 0x08, 0x10,
    0x75, 0x04, 0x53, 0x6C, 0x04, 0xFD, 0x91, 0xF3, 0x31, 0x93,
    0xB6, 0x14, 0xE3, 0x53, 0xF6, 0xCE, 0x6E, 0xC3, 0x74, 0xFE,
    0xCE, 0x62, 0x01, 0xBD, 0x8D, 0x11, 0x26, 0x39, 0x0A, 0x74,
    0x51, 0xCA, 0x56, 0x42, 0x51, 0xD5, 0x7B, 0x8E, 0xA6, 0x47,
    0xDC, 0x7F, 0x74, 0x09, 0x90, 0x8F, 0x9A, 0xF2, 0x0C, 0x74,
    0x81, 0x64, 0x10, 0x0D, 0x64, 0xCE, 0x54, 0xB5, 0x78, 0x81,
    0xA5, 0x90, 0x36, 0xEB, 0x82, 0xC9, 0xE7, 0x5C, 0xBD, 0x3F,
    0x3B, 0x29, 0xD3, 0x2F, 0x22, 0x6E, 0x6F, 0x24, 0xDD, 0xFB,
    0xDD, 0x98, 0x00, 0x1D, 0x4B, 0x82, 0xCE, 0x12, 0xD1, 0x33,
    0x29, 0x22, 0x4F, 0x92, 0xF9, 0x94, 0xEB, 0x12, 0x57, 0x2F,
    0xFA, 0x30, 0xC7, 0xF1, 0x9D, 0x72, 0xCA, 0x8D, 0x25, 0xEB,
    0x2C, 0x3D, 0xE3, 0xFB, 0xCC, 0xBC, 0x54, 0x11, 0x53, 0x25,
    0xE2, 0xCE, 0x78, 0xF9, 0xDC, 0x6F, 0xE8, 0xE2, 0xFB, 0x41,
    0x3C, 0xED, 0x6F, 0x9A, 0xB1, 0xF3, 0x72, 0x78, 0x02, 0xCC,
    0x91, 0x3D, 0x20, 0x7F, 0xBE, 0xE9, 0x53, 0xD4, 0xFB, 0xFF,
    0x6E, 0x42, 0xB1, 0xF6, 0x5E, 0x4D, 0x14, 0x03, 0xB4, 0xFB,
    0x2F, 0x53, 0x7A, 0xBC, 0x9E, 0xA7, 0xCE, 0x8E, 0xCA, 0x08,
    0xC4, 0x7B, 0x19, 0xA1, 0x2B, 0x7F
]
```

---

### Private Key 2 (_privateKey2) - 256 bytes

**Location**: `Home_Anywhere_D.Anb.Ha.Commun.IPcom.TCPSecureCommunication`
**Usage**: Fallback encryption key (when PublicKey is NULL or empty)

**Hexadecimal**:
```
0C 74 81 64 10 0D 64 CE 54 B5 78 81 A5 90 36 EB
82 C9 E7 5C BD 3F 3B 29 D3 2F 22 6E 6F 24 DD FB
DD 98 00 1D 4B 82 CE 12 D1 33 29 22 4F 92 F9 94
EB 12 57 2F FA 30 C7 F1 9D 72 CA 8D 25 EB 2C 3D
E3 FB CC BC 54 11 53 25 E2 CE 78 F9 DC 6F E8 E2
FB 41 3C ED 6F 9A B1 F3 72 78 02 CC 91 3D 20 7F
BE E9 53 D4 FB FF 6E 42 B1 F6 5E 4D 14 03 B4 FB
2F 53 7A BC 9E A7 CE 8E CA 08 C4 7B 19 A1 2B 7F
53 83 FB 32 7F 7E 9A E9 01 B3 7F 80 06 CF 39 26
6F 5D 25 5B 1E 26 28 C4 B3 78 04 AC 9F 0B AE 9D
57 AC 4E 82 0E B4 BA 6C 27 38 0A 71 9B E1 F7 FD
14 CC 14 0D 71 E5 B8 F7 7C CB E0 0B 04 78 B1 7F
2B EA 85 41 95 22 18 EE 06 FF 79 13 26 D3 08 10
75 04 53 6C 04 FD 91 F3 31 93 B6 14 E3 53 F6 CE
6E C3 74 FE CE 62 01 BD 8D 11 26 39 0A 74 51 CA
56 42 51 D5 7B 8E A6 47 DC 7F 74 09 90 8F 9A F2
```

**C# Array**:
```csharp
byte[] _privateKey2 = new byte[256] {
    12, 116, 129, 100, 16, 13, 100, 206, 84, 181,
    120, 129, 165, 144, 54, 235, 130, 201, 231, 92,
    189, 63, 59, 41, 211, 47, 34, 110, 111, 36,
    221, 251, 221, 152, 0, 29, 75, 130, 206, 18,
    209, 51, 41, 34, 79, 146, 249, 148, 235, 18,
    87, 47, 250, 48, 199, 241, 157, 114, 202, 141,
    37, 235, 44, 61, 227, 251, 204, 188, 84, 17,
    83, 37, 226, 206, 120, 249, 220, 111, 232, 226,
    251, 65, 60, 237, 111, 154, 177, 243, 114, 120,
    2, 204, 145, 61, 32, 127, 190, 233, 83, 212,
    251, 255, 110, 66, 177, 246, 94, 77, 20, 3,
    180, 251, 47, 83, 122, 188, 158, 167, 206, 142,
    202, 8, 196, 123, 25, 161, 43, 127, 83, 131,
    251, 50, 127, 126, 154, 233, 1, 179, 127, 128,
    6, 207, 57, 38, 111, 93, 37, 91, 30, 38,
    40, 196, 179, 120, 4, 172, 159, 11, 174, 157,
    87, 172, 78, 130, 14, 180, 186, 108, 39, 56,
    10, 113, 155, 225, 247, 253, 20, 204, 20, 13,
    113, 229, 184, 247, 124, 203, 224, 11, 4, 120,
    177, 127, 43, 234, 133, 65, 149, 34, 24, 238,
    6, 255, 121, 19, 38, 211, 8, 16, 117, 4,
    83, 108, 4, 253, 145, 243, 49, 147, 182, 20,
    227, 83, 246, 206, 110, 195, 116, 254, 206, 98,
    1, 189, 141, 17, 38, 57, 10, 116, 81, 202,
    86, 66, 81, 213, 123, 142, 166, 71, 220, 127,
    116, 9, 144, 143, 154, 242
};
```

**Note**: privateKey2 is privateKey rotated by 128 bytes (second half + first half)

---

## 2. PUBLIC KEY (Server-Provided)

**Size**: 128 bytes (variable per session)
**Source**: Received from server in ConnectResponseCommand
**Extraction**: bytes[7:135] from ConnectResponse (skip first 7, take 128)
**Code Location**: `IPCommunication.ConnectResponded()` line 410

**Extraction Code**:
```csharp
SetPublicKey(SubResponse(((ConnectResponseCommand)response).PublicKey));

// SubResponse definition:
public byte[] SubResponse(byte[] bytes) {
    return bytes.Skip(7).Take(128).ToArray();
}
```

**NOTE**: Public key changes per session and must be captured from server response after authentication.

---

## 3. ENCRYPTION ALGORITHM

**Location**: `TCPSecureCommunication.SendBytes()` and `BytesReceived()`

### Encryption (Sending):
```csharp
int index = 0;
for (int i = 0; i < bytes.Length; i++) {
    index ^= i;  // XOR index with byte position
    int original = bytes[i];

    if (publicKey != null && publicKey.Length > 0)
        bytes[i] = (byte)(original ^ privateKey[index] ^ publicKey[index % publicKey.Length]);
    else
        bytes[i] = (byte)(original ^ privateKey2[index]);

    index = bytes[i];  // Update index to ENCRYPTED byte
}
```

### Decryption (Receiving):
```csharp
int index = 0;
for (int i = 0; i < bytes.Length; i++) {
    index ^= i;  // XOR index with byte position
    int encrypted = bytes[i];

    if (publicKey != null && publicKey.Length > 0)
        bytes[i] = (byte)(encrypted ^ privateKey[index] ^ publicKey[index % publicKey.Length]);
    else
        bytes[i] = (byte)(encrypted ^ privateKey2[index]);

    index = encrypted;  // Update index to ORIGINAL encrypted byte (NOT decrypted)
}
```

**CRITICAL DIFFERENCE**:
- **Encryption**: `index = encrypted_byte` (after XOR)
- **Decryption**: `index = encrypted_byte` (before XOR - preserved original)

---

## 4. DATABASE CREDENTIALS

**Location**: `Home_Anywhere_D.dll.config` (line 8)
**Database**: SQLite (HomeanywhereStorage.db)

**Connection String (Secure)**:
```
Data Source=.\HomeanywhereStorage.db;Version=3;Password=if1zen4L7;
```

**Database Password**: `if1zen4L7`

**Connection String (Non-Secure)**:
```
Data Source=.\HomeanywhereStorage.db;Version=3;
```

---

## 5. SERVER CONNECTION DETAILS

**Server Address**: megane-david.dyndns.info
**Server Port**: 5000
**Protocol**: TCP with custom XOR encryption

**Test Credentials** (from user):
- **Username**: ppssecurity
- **Password**: 667166mm

---

## 6. PROTOCOL CONSTANTS

### Frame Constants:
- **Start Marker**: `0x23` (ASCII '#')
- **Default Bus**: 1 or 2
- **Max EXO Modules**: 16
- **Outputs per Module**: 8
- **Status Response Size**: 128 bytes (16 modules Ã— 8 bytes)

### Command IDs:
- **ConnectRequest**: ID=1, Version=2
- **FrameRequest**: ID=4, Version=1
- **ExoOutputsRequest**: ID=5, Version=1

### Output Value Constants:
- **OFF**: `0x00` (0)
- **ON**: `0xFF` (255)
- **Dimming Range**: `0x01-0xFE` (1-254)

### Timing Constants:
- Socket Send Timeout: 3000ms
- Socket Receive Timeout: 6000ms
- Command Queue Delay: 250ms
- Connection Timeout: 1000ms

---

## 7. AUTHENTICATION FORMAT

### Username Field:
- **Prefix**: "USER:" (5 bytes)
- **Total Length**: 26 bytes (padded with spaces)
- **Example**: `"USER:ppssecurity        "` (26 bytes)

### Password Field:
- **Prefix**: "PWD:" (4 bytes)
- **Total Length**: 26 bytes (padded with spaces)
- **Example**: `"PWD:667166mm           "` (26 bytes)

### Complete Auth Packet (before encryption):
```
01 02                                           // Command ID=1, Version=2
55 53 45 52 3A 6A 64 65 6C 73 69 6E 6E 65 ...  // "USER:ppssecurity" + spaces (26 bytes)
50 57 44 3A 31 32 33 34 35 36 37 38 39 ...     // "PWD:667166mm" + spaces (26 bytes)
01                                              // Bus number
00                                              // Bus lock
```

---

## 8. IMPLEMENTATION - ENCRYPTION/DECRYPTION

### Python Implementation:

```python
def encrypt_bytes(data, private_key, public_key=None):
    encrypted = bytearray(data)
    index = 0

    for i in range(len(encrypted)):
        index ^= i
        original = encrypted[i]

        if public_key and len(public_key) > 0:
            encrypted[i] = original ^ private_key[index] ^ public_key[index % len(public_key)]
        else:
            encrypted[i] = original ^ private_key2[index]

        index = encrypted[i]  # Use ENCRYPTED byte

    return bytes(encrypted)

def decrypt_bytes(data, private_key, public_key=None):
    decrypted = bytearray(data)
    index = 0

    for i in range(len(decrypted)):
        index ^= i
        encrypted_byte = decrypted[i]  # Save original

        if public_key and len(public_key) > 0:
            decrypted[i] = encrypted_byte ^ private_key[index] ^ public_key[index % len(public_key)]
        else:
            decrypted[i] = encrypted_byte ^ private_key2[index]

        index = encrypted_byte  # Use ORIGINAL encrypted byte

    return bytes(decrypted)
```

---

## 9. KEY OBSERVATIONS

1. **privateKey2 = privateKey rotated 128 bytes** (second half + first half)
2. **Public key is session-based** and provided by server after authentication
3. **Chained indexing** - each byte affects the next index calculation
4. **Same algorithm** for encryption/decryption with index management difference
5. **No IV or salt** - deterministic encryption
6. **Weak security** - XOR cipher with hardcoded keys is easily reversible
7. **Database password exposed** in cleartext config file

---

## 10. SECURITY VULNERABILITIES

### CRITICAL ISSUES FOUND:

1. Hardcoded encryption keys in binary (easily extracted)
2. Weak XOR-based encryption (not cryptographically secure)
3. No TLS/SSL for TCP connection
4. Database password in cleartext config file
5. Deterministic encryption (same plaintext = same ciphertext)
6. No key rotation mechanism
7. Public key transmitted without certificate validation

### RECOMMENDATIONS:

- Implement **TLS 1.3** for transport security
- Use **AES-256-GCM** or **ChaCha20-Poly1305** for encryption
- Implement proper key exchange (**ECDH**)
- Store database password in encrypted form
- Add authentication tokens with expiration
- Implement certificate pinning for server validation
- Add message authentication codes (**HMAC**)

---

## 11. COMPLETE KEY SUMMARY

| Key Type | Size | Usage | Location |
|----------|------|-------|----------|
| privateKey | 256 bytes | Primary encryption | TCPSecureCommunication |
| privateKey2 | 256 bytes | Fallback encryption | TCPSecureCommunication |
| publicKey | 128 bytes | Session key (server-provided) | ConnectResponseCommand |
| Database Password | String | SQLite encryption | Home_Anywhere_D.dll.config |
| Server Address | String | megane-david.dyndns.info:5000 | Configuration |
| Test Credentials | String | ppssecurity / 667166mm | User-provided |

---

**END OF KEY EXTRACTION REPORT**
